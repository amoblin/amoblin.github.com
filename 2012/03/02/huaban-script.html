<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Linghua Zhang" />
    <title>花瓣网抓取图片脚本</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/atom.xml" rel="alternate" title="setImpl" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/styles/style.css">
    <link rel="stylesheet" href="/media/styles/github.css">
    <script type="text/javascript" src="/media/js/highlight.pack.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1>花瓣网抓取图片脚本</h1>
        </header>
        <nav>
        <span><a title="home page" class="" href="/">home</a></span>
        <span><a title="tags" class="" href="/tags.html">tags</a></span>
        <span><a title="blogroll" class="" href="/links.html">links</a></span>
        <span><a title="subscribe me" class="" href="/atom.xml">feed</a></span>
        </nav>
        <article class="content">
        <section class="post">
<!-- id: 18 -->
<!-- publish: YES -->
<p>最早关注的不是花瓣网，是topit.me，这个网站不错，格调很高雅。</p>
<p>后来听说了Pinterest，然后是国内的花瓣网。花瓣网上主题，分类比较明确，看了页面，
组织也整齐，于是写了个花瓣网的图片抓取脚本。</p>
<p>其中有一个小问题，就是抓取的专辑beauty页面中，由于它是下拉刷新加载页面的，使用
urlretrieve不能下载下来，只能借助外部的curl了。有高手能解决的，还请不吝赐教。</p>
<p>代码下载地址: <a class="reference external" href="https://gist.github.com/1956744">https://gist.github.com/1956744</a></p>
<p>内容不多，直接贴下：</p>
<pre class="code python literal-block">
<span class="comment">#!/usr/bin/env python</span>
<span class="comment"># -*- coding: utf8 -*-</span>
<span class="comment"># author: amoblin &lt;amoblin&#64;163.com&gt;</span>

<span class="keyword namespace">import</span> <span class="name namespace">sys</span><span class="operator">,</span> <span class="name namespace">re</span><span class="operator">,</span> <span class="name namespace">urllib2</span><span class="operator">,</span> <span class="name namespace">os</span><span class="operator">,</span> <span class="name namespace">urllib</span>

<span class="name">beauty_url</span> <span class="operator">=</span> <span class="literal string">&quot;http://huaban.com/favorite/beauty/&quot;</span>
<span class="name">pin_re</span> <span class="operator">=</span> <span class="literal string">'&lt;a href=&quot;/pins/(.+?)/&quot;'</span>

<span class="keyword">def</span> <span class="name function">get_img_url</span><span class="punctuation">(</span><span class="name">pin</span><span class="punctuation">):</span>
    <span class="name">pin_url</span> <span class="operator">=</span> <span class="literal string">&quot;http://huaban.com/pins/</span><span class="literal string interpol">%s</span><span class="literal string">/&quot;</span> <span class="operator">%</span> <span class="name">pin</span>
    <span class="name">img_url_re</span> <span class="operator">=</span> <span class="literal string">'&lt;img alt=&quot;采集图片&quot; src=&quot;(.+?)&quot;'</span>
    <span class="name">pg</span> <span class="operator">=</span> <span class="name">urllib2</span><span class="operator">.</span><span class="name">urlopen</span><span class="punctuation">(</span><span class="name">pin_url</span><span class="punctuation">)</span>
    <span class="name">content</span> <span class="operator">=</span> <span class="name">pg</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">()</span>
    <span class="name">pg</span><span class="operator">.</span><span class="name">close</span><span class="punctuation">()</span>
    <span class="name">img_url</span> <span class="operator">=</span> <span class="name">re</span><span class="operator">.</span><span class="name">findall</span><span class="punctuation">(</span><span class="name">img_url_re</span><span class="punctuation">,</span> <span class="name">content</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span>
    <span class="keyword">return</span> <span class="name">img_url</span>

<span class="keyword">if</span> <span class="name">__name__</span> <span class="operator">==</span> <span class="literal string">&quot;__main__&quot;</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="name builtin">len</span><span class="punctuation">(</span><span class="name">sys</span><span class="operator">.</span><span class="name">argv</span><span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="literal number integer">2</span><span class="punctuation">:</span>
        <span class="name">local_path</span> <span class="operator">=</span> <span class="literal string">&quot;./huaban&quot;</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="name">local_path</span> <span class="operator">=</span> <span class="name">sys</span><span class="operator">.</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span>

    <span class="keyword">if</span> <span class="operator word">not</span> <span class="name">os</span><span class="operator">.</span><span class="name">path</span><span class="operator">.</span><span class="name">exists</span><span class="punctuation">(</span><span class="name">local_path</span><span class="punctuation">):</span>
        <span class="keyword">try</span><span class="punctuation">:</span>
            <span class="name">os</span><span class="operator">.</span><span class="name">makedirs</span><span class="punctuation">(</span><span class="name">local_path</span><span class="punctuation">)</span>
        <span class="keyword">except</span> <span class="name">e</span><span class="punctuation">:</span>
            <span class="keyword">print</span> <span class="name">e</span>
            <span class="name">sys</span><span class="operator">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="punctuation">)</span>

    <span class="keyword">print</span> <span class="literal string">&quot;pin images will saved to: </span><span class="literal string interpol">%s</span><span class="literal string">&quot;</span> <span class="operator">%</span> <span class="name">local_path</span>

    <span class="name">os</span><span class="operator">.</span><span class="name">system</span><span class="punctuation">(</span><span class="literal string">&quot;curl -s </span><span class="literal string interpol">%s</span><span class="literal string"> -o /tmp/huaban.html&quot;</span> <span class="operator">%</span> <span class="name">beauty_url</span><span class="punctuation">)</span>
    <span class="name">content</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string">&quot;/tmp/huaban.html&quot;</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">()</span>

    <span class="name">pins</span> <span class="operator">=</span> <span class="name">re</span><span class="operator">.</span><span class="name">findall</span><span class="punctuation">(</span><span class="name">pin_re</span><span class="punctuation">,</span> <span class="name">content</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">:]</span>
    <span class="keyword">for</span> <span class="name">pin</span> <span class="operator word">in</span> <span class="name">pins</span><span class="punctuation">:</span>
        <span class="name">img_url</span> <span class="operator">=</span> <span class="name">get_img_url</span><span class="punctuation">(</span><span class="name">pin</span><span class="punctuation">)</span>
        <span class="keyword">print</span> <span class="literal string">&quot;saving pin: </span><span class="literal string interpol">%s</span><span class="literal string">&quot;</span> <span class="operator">%</span> <span class="name">pin</span>
        <span class="name">urllib</span><span class="operator">.</span><span class="name">urlretrieve</span><span class="punctuation">(</span><span class="name">img_url</span><span class="punctuation">,</span> <span class="literal string">&quot;</span><span class="literal string interpol">%s</span><span class="literal string">/</span><span class="literal string interpol">%s</span><span class="literal string">.jpeg&quot;</span> <span class="operator">%</span> <span class="punctuation">(</span><span class="name">local_path</span><span class="punctuation">,</span> <span class="name">pin</span><span class="punctuation">))</span>
</pre>
</section>
<section class="meta">

<span class="tags">
  tagged by 
  
</span>

<span class="time">
  <time datetime="2012-03-02">2012-03-02</time>
</span>
</section>


        </article>
        <!-- PingLun.La Begin -->
        <div id="pinglunla_here"></div><a href="http://pinglun.la/" id="logo-pinglunla">评论啦</a><script type="text/javascript" src="http://static.pinglun.la/md/pinglun.la.js" charset="utf-8"></script>
        <!-- PingLun.La End -->
        <div id="copy">&copy; 2012 amoblin | powered by jekyll | themed by <a href="http://lhzhang.com" title="sext ii">sext ii</a></div>
      </div>
    </div> <!--! end of #container -->
  </body>
</html>
